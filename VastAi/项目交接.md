1. 先了解modelZoom的预测流程，分析modelzoom的运行需要的配置信息，以及如何预测的
2. 实现Predictor接口（有可能需要写新的config）

# 环境搭建

## docker 环境

```bash
docker run \
	--runtime=vastai \
	-e VASTAI_VISIBLE_DEVICES=all \
	--name huangzhen_sdk1.1 \
	-it \
	-v/home/vastai/workspace:/workspace  \
	tvm_base:v1.1 \
	/bin/bash
```

## Network类用法

```c++
class Network {
 public:
  Network(uint32_t die_id);
  ~Network();
  // 构造Stream
  bool constructStream(string json_path);
  // 指定输入数据
  bool setInput(void *host_addres, int filesize);
  // 获取输出数据
  vector<float> getOutput();
   
};
```

**使用样例:**

```c++
 // 初始化设备资源
if (!vaclInit(die_id_)) {
    std::cout << "Error: Failed to init SDK";
    return NNADAPTER_DEVICE_NOT_FOUND;
}
net_.reset(new Network(die_id_));

// 指定输入数据
int size = 224 * 224 * 3;

net_->setInput((void*)host_ptr, size);

// 获取输出
std::vector<float> out_data = net_->getOutput();

```



## ResNet50.NB的ProgramDesc举例

```c++
version=2001002;
op_version_map_={};
```



### BlockDesc:0

```c++
idx = 0;
parent_idx = -1;
forward_block_idx = -1;
```

#### OpDesc:0

```c++
type:"feed"
input:{{"X", {"feed"}}}
output:{{"Out", {"x"}}}
attrs:{{"__@kernel_type_attr@__", "\xc0%\xaa\x86\xb3U"}, {"col", 0}, {"op_device", "\xf0%\xaa\x86\xb3U} }
attr_types:{{"__@kernel_type_attr@__",OpAttrType::STRING}, {"col", OpAttrType::INT}, {"op_device", OpAttrType::STRING}}
```



#### OpDesc:1

```c++
type:"subgraph"
input:{{"Inputs", {"batch_norm_9.w_2", "batch_norm_9.w_0","batch_norm_9.w_1"}, ..., "x"}
output:{{"Outputs", {"batch_norm_9.tmp_1", ...,"save_infer_model/scale_0.tmp_1"}}}
attrs:{{"__@kernel_type_attr@__", "subgraph/def/18/4/1"}, {"input_data_names", "x"}, {"output_data_names", "save_infer_model/scale_0"}, {"sub_block", 1}}
attr_types:{{"__@kernel_type_attr@__",OpAttrType::STRING}, {"input_data_names", OpAttrType::STRING}, {"output_data_names", OpAttrType::STRING}, {"sub_block", INT}}
```

#### OpDesc:2

```c++
type:"fetch"
input:{{"X", {"save_infer_model/scale_0.tmp_1"}
output:{{"Out", {"fetch"}}}
attrs:{{"__@kernel_type_attr@__", }, {"col", }, {"data_type", }, {"op_device", } }
attr_types:{{"__@kernel_type_attr@__",OpAttrType::STRING}, {"col", OpAttrType::INT}, {"data_type", OpAttrType::INT}, {"op_device",OpAttrType::STRING }}
```



#### VarDesc:0

```c++
name_:"feed";
type_:FEED_MINBATCH;
data_type:FP32;
persistable=true;
shape_:{};
```

#### VarDesc:1

```c++
name_:"x";
type_:LOD_TENSOR;
data_type:FP32;
persistable=false;
shape_:{-1, 3, 244, 244};
```

